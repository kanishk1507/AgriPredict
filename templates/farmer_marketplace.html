{% extends "base.html" %}

{% block title %}Farmer Marketplace - Buy & Sell{% endblock %}

{% block content %}
<section class="py-5">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col-lg-8 mx-auto">
                <h2 class="text-plant-primary">
                    <i class="fas fa-store me-2"></i>Farmer Marketplace
                </h2>
                <p class="text-muted">Buy and sell directly with fellow farmers</p>
            </div>
        </div>
        
        <!-- Marketplace Categories -->
        <div class="row mb-5">
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="category-card text-center p-4 bg-success bg-opacity-10 rounded">
                    <i class="fas fa-seedling fa-3x text-success mb-3"></i>
                    <h5>Seeds & Plants</h5>
                    <p class="small">Quality seeds and saplings</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="category-card text-center p-4 bg-warning bg-opacity-10 rounded">
                    <i class="fas fa-tractor fa-3x text-warning mb-3"></i>
                    <h5>Equipment</h5>
                    <p class="small">Farming tools and machinery</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="category-card text-center p-4 bg-primary bg-opacity-10 rounded">
                    <i class="fas fa-apple-alt fa-3x text-primary mb-3"></i>
                    <h5>Fresh Produce</h5>
                    <p class="small">Fruits and vegetables</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="category-card text-center p-4 bg-info bg-opacity-10 rounded">
                    <i class="fas fa-flask fa-3x text-info mb-3"></i>
                    <h5>Fertilizers</h5>
                    <p class="small">Organic and chemical fertilizers</p>
                </div>
            </div>
        </div>
        
        <!-- Post New Listing -->
        <div class="row mb-5">
            <div class="col-lg-8 mx-auto">
                <div class="card border-primary">
                    <div class="card-header bg-primary text-white text-center">
                        <h5 class="mb-0">Post New Listing</h5>
                    </div>
                    <div class="card-body">
                        <form id="listing-form">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Your Name *</label>
                                    <input type="text" class="form-control" name="farmer_name" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Contact Number *</label>
                                    <input type="tel" class="form-control" name="contact" required>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Location *</label>
                                    <input type="text" class="form-control" name="location" 
                                           placeholder="City, State" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Listing Type *</label>
                                    <select class="form-select" name="listing_type" required>
                                        <option value="">Select Type</option>
                                        <option value="sell">For Sale</option>
                                        <option value="buy">Looking to Buy</option>
                                        <option value="rent">For Rent</option>
                                        <option value="exchange">Exchange/Barter</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Item/Product Name *</label>
                                    <input type="text" class="form-control" name="item_name" 
                                           placeholder="e.g., Wheat Seeds, Tractor" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Quantity</label>
                                    <input type="text" class="form-control" name="quantity" 
                                           placeholder="e.g., 50 kg, 1 unit">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Price</label>
                                    <input type="text" class="form-control" name="price" 
                                           placeholder="e.g., ₹500/kg, ₹50,000">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Description *</label>
                                <textarea class="form-control" name="description" rows="3" 
                                          placeholder="Provide details about the item..." required></textarea>
                            </div>
                            
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-plus me-2"></i>Post Listing
                                </button>
                            </div>
                        </form>
                        
                        <div id="listing-result" class="mt-3" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sample Listings -->
        <div class="row">
            <div class="col-12 mb-4">
                <h4 class="text-plant-primary">Recent Listings</h4>
            </div>
            
            <div class="col-lg-4 mb-4">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between">
                        <span class="badge bg-success">For Sale</span>
                        <small class="text-muted">2 hours ago</small>
                    </div>
                    <div class="card-body">
                        <h6>Organic Wheat Seeds</h6>
                        <p class="text-muted small mb-2">
                            <i class="fas fa-user me-1"></i>Ramesh Sharma • 
                            <i class="fas fa-map-marker-alt me-1"></i>Jaipur, Rajasthan
                        </p>
                        <p class="small">High quality certified organic wheat seeds. Yield: 45-50 qtl/acre</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <strong class="text-success">₹35/kg</strong>
                            <button class="btn btn-sm btn-outline-primary">Contact</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4 mb-4">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between">
                        <span class="badge bg-warning">For Rent</span>
                        <small class="text-muted">5 hours ago</small>
                    </div>
                    <div class="card-body">
                        <h6>Harvester Combine</h6>
                        <p class="text-muted small mb-2">
                            <i class="fas fa-user me-1"></i>Sunil Patel • 
                            <i class="fas fa-map-marker-alt me-1"></i>Indore, MP
                        </p>
                        <p class="small">Well maintained New Holland combine harvester available for rent</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <strong class="text-success">₹1,200/hour</strong>
                            <button class="btn btn-sm btn-outline-primary">Contact</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4 mb-4">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between">
                        <span class="badge bg-primary">Looking to Buy</span>
                        <small class="text-muted">1 day ago</small>
                    </div>
                    <div class="card-body">
                        <h6>Fresh Tomatoes</h6>
                        <p class="text-muted small mb-2">
                            <i class="fas fa-user me-1"></i>Vendor Company • 
                            <i class="fas fa-map-marker-alt me-1"></i>Delhi
                        </p>
                        <p class="small">Looking for bulk supply of fresh tomatoes for wholesale market</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <strong class="text-success">₹15-20/kg</strong>
                            <button class="btn btn-sm btn-outline-primary">Contact</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
document.getElementById('listing-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const data = {
        farmer_name: formData.get('farmer_name'),
        contact: formData.get('contact'),
        location: formData.get('location'),
        listing_type: formData.get('listing_type'),
        item_name: formData.get('item_name'),
        quantity: formData.get('quantity'),
        price: formData.get('price'),
        description: formData.get('description')
    };
    
    try {
        const response = await fetch('/api/submit-listing', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            document.getElementById('listing-result').innerHTML = `
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>
                    ${result.message}<br>
                    <small>Listing ID: ${result.listing_id}</small>
                </div>
            `;
            document.getElementById('listing-result').style.display = 'block';
            e.target.reset();
        } else {
            throw new Error(result.error);
        }
    } catch (error) {
        document.getElementById('listing-result').innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Error: ${error.message}
            </div>
        `;
        document.getElementById('listing-result').style.display = 'block';
    }
});
</script>
{% endblock %}
